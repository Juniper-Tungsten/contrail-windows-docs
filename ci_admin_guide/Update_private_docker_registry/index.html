<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Update private docker registry - Tungsten Fabric for Windows Documentation</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../highlight.css" rel="stylesheet">
  <link href="../../theme.css" rel="stylesheet">
  <link href="../../theme_extra.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Update private docker registry";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Tungsten Fabric for Windows Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Style guides</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../style_guides/C/">C</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../style_guides/Cpp/">Cpp</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../style_guides/Go/">Go</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Windows compute</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../windows_compute/Communication_Agent_Extension/">Communication Agent Extension</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../windows_compute/Container_creation_lifecycle/">Container creation lifecycle</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../windows_compute/Docker_on_Windows/">Docker on Windows</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../windows_compute/Forwarding_extension/">Forwarding extension</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../windows_compute/HyperV_extensible_switch/">HyperV extensible switch</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../windows_compute/Linux_Overview/">Linux Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../windows_compute/Network_creation_lifecycle/">Network creation lifecycle</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../windows_compute/Root_HNS_network/">Root HNS network</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../windows_compute/Utility_tools/">Utility tools</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../windows_compute/_Blueprint/"> Blueprint</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../windows_compute/vRouter_Linux_implementation/">vRouter Linux implementation</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>User guide</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../user_guide/caveats/">Caveats</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Updating documentation</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../updating_documentation/How_to_update_this_documentation/">How to update this documentation</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Ci admin guide</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Infrastructure_backups/">Infrastructure backups</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../List_of_VMs_in_Windows_CI/">List of VMs in Windows CI</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Merge_development_to_production/">Merge development to production</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Run_gerrit_pipeline_on_github_PR/">Run gerrit pipeline on github PR</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Update_Zuul/">Update Zuul</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Update private docker registry</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#how-to-update-private-docker-registry">How to update private docker registry</a></li>
                
                    <li><a class="toctree-l4" href="#when-is-the-update-needed-what-need-to-be-updated">When is the update needed? What need to be updated?</a></li>
                
                    <li><a class="toctree-l4" href="#how-to-update">How to update</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Windows_CI_logs_layout/">Windows CI logs layout</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Developer guide</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developer_guide/HNS_error_bestiary/">HNS error bestiary</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Building</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../developer_guide/building/Dockerized_builder_using_ansible/">Dockerized builder using ansible</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Contrail deployment</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../contrail_deployment/CAD_for_windows_design/">CAD for windows design</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../contrail_deployment/Devenv_in_local_env/">Devenv in local env</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../contrail_deployment/contrail_ansible_deployer/">Contrail ansible deployer</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Tungsten Fabric for Windows Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Ci admin guide &raquo;</li>
        
      
    
    <li>Update private docker registry</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="how-to-update-private-docker-registry">How to update private docker registry</h1>
<h2 id="when-is-the-update-needed-what-need-to-be-updated">When is the update needed? What need to be updated?</h2>
<p>The update of local docker registry is required when the version of Controller used in Windows CI is updated to a newer one. All Contrail images required by Contrail Ansible Deployer running in Windows CI have to be updated to version matching selected Controller version. Some new cached Openstack images may be required by updated Contrail Ansible Deployer.</p>
<h2 id="how-to-update">How to update</h2>
<h3 id="how-to-update-contrail-images">How to update Contrail images</h3>
<ol>
<li>
<p>Choose Contrail version tag you want to be cached in private docker registry:</p>
<ul>
<li>all available tags can be found <a href="https://hub.docker.com/r/opencontrailnightly/contrail-vrouter-agent/tags/">here</a>.</li>
</ul>
</li>
<li>
<p>Log into <code>winci-registry</code>:</p>
<ul>
<li>please contact Windows CI team for access.</li>
</ul>
</li>
<li>
<p>Check if there is <code>update-docker-registry.py</code> script in root directory.</p>
</li>
<li>
<p>If there is no such script:</p>
<ul>
<li>
<p>download it from <a href="https://github.com/Juniper/contrail-windows-ci/tree/development/utility/update_docker_registry">here</a>:</p>
<p><code>curl https://raw.githubusercontent.com/Juniper/contrail-windows-ci/development/utility/update_docker_registry/update-docker-registry.py --output update-docker-registry.py</code></p>
</li>
<li>
<p>make it executable:</p>
<p><code>chmod +x ./update-docker-registry.py</code></p>
</li>
</ul>
</li>
<li>
<p>Run the script with Contrail version tag as parameter, for example:</p>
<p><code>./update-docker-registry.py ocata-master-206</code></p>
</li>
<li>
<p>If new version of Contrail Ansible Deployer uses more images than listed in <code>update-docker-registry.py</code> script:</p>
<ul>
<li>update images list in the script locally,</li>
<li>open up a PR with updated images list to contrail-windows-ci.</li>
</ul>
</li>
</ol>
<h3 id="how-to-update-openstack-images">How to update Openstack images</h3>
<p>New version of Contrail Ansible Deployer may also use some new Openstack images. Currently there is no script that does this automatically. For caching Openstack images manually please do the folowing:</p>
<ol>
<li>
<p>Log into <code>winci-registry</code>:</p>
<ul>
<li>please contact Windows CI team for access.</li>
</ul>
</li>
<li>
<p>Set the name of required image in local variable (replace <code>&lt;IMAGE-NAME&gt;</code> with proper value:</p>
<p><code>image_name=&lt;IMAGE-NAME&gt;</code></p>
</li>
<li>
<p>Pull the image:</p>
<p><code>docker image pull ci-repo.englab.juniper.net:5000/kolla/${image_name}:ocata</code></p>
</li>
<li>
<p>Get the Image ID of previously pulled image:</p>
<p><code>image_id=$(docker image ls | grep kolla | grep ${image_name} | awk '{ print $3 }' | uniq)</code></p>
<ul>
<li>
<p>verify the ID:</p>
<p><code>echo "$image_id"</code></p>
</li>
</ul>
</li>
<li>
<p>Tag the image:</p>
<p><code>docker tag ${image_id} localhost:5000/kolla/${image_name}:ocata</code></p>
</li>
<li>
<p>Push the image to local repository:</p>
<p><code>docker push localhost:5000/kolla/${image_name}:ocata</code></p>
</li>
<li>
<p>Repeat steps 2-6 for all other required images.</p>
</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Windows_CI_logs_layout/" class="btn btn-neutral float-right" title="Windows CI logs layout"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Update_Zuul/" class="btn btn-neutral" title="Update Zuul"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Update_Zuul/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Windows_CI_logs_layout/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
