<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Update Zuul layout - Tungsten Fabric for Windows Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../highlight.css" rel="stylesheet">
  <link href="../../theme.css" rel="stylesheet">
  <link href="../../theme_extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Update Zuul layout";
    var mkdocs_page_input_path = "ci_admin_guide/Update_zuul_layout.md";
    var mkdocs_page_url = "/ci_admin_guide/Update_zuul_layout/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Tungsten Fabric for Windows Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Ci admin guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../List_of_VMs_in_Windows_CI/">List of all important VMs in Windows CI</a>
                </li>
                <li class="">
                    
    <a class="" href="../Merge_development_to_production/">Merge development to production</a>
                </li>
                <li class="">
                    
    <a class="" href="../Run_gerrit_pipeline_on_github_PR/">Run gerrit pipeline on github PR</a>
                </li>
                <li class="">
                    
    <a class="" href="../Update_Zuul/">Update Windows CI Zuulv2</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Update Zuul layout</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#update-zuul-layout">Update Zuul layout</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#1-commit-updated-layoutyaml-file-to-specific-windows-ci-git-repository">1. Commit updated layout.yaml file to specific Windows CI git repository.</a></li>
        
            <li><a class="toctree-l4" href="#2-reload-zuul-configuration">2. Reload Zuul configuration.</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Contrail deployment</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../contrail_deployment/contrail_ansible_deployer/">Contrail ansible deployer</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developer guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../developer_guide/HNS_error_bestiary/">HNS error bestiary</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Building</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../developer_guide/building/Dockerized_builder_using_ansible/">Dockerized builder using ansible</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Style guides</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../style_guides/C/">C</a>
                </li>
                <li class="">
                    
    <a class="" href="../../style_guides/Cpp/">Cpp</a>
                </li>
                <li class="">
                    
    <a class="" href="../../style_guides/Go/">Go</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Updating documentation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../updating_documentation/How_to_update_this_documentation/">How to update this documentation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Windows compute</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../windows_compute/Communication_Agent_Extension/">Communication Agent Extension</a>
                </li>
                <li class="">
                    
    <a class="" href="../../windows_compute/Container_creation_lifecycle/">Container creation lifecycle</a>
                </li>
                <li class="">
                    
    <a class="" href="../../windows_compute/Docker_on_Windows/">Docker on Windows</a>
                </li>
                <li class="">
                    
    <a class="" href="../../windows_compute/Forwarding_extension/">Forwarding extension</a>
                </li>
                <li class="">
                    
    <a class="" href="../../windows_compute/HyperV_extensible_switch/">HyperV extensible switch</a>
                </li>
                <li class="">
                    
    <a class="" href="../../windows_compute/Linux_Overview/">Linux Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../windows_compute/Network_creation_lifecycle/">Network creation lifecycle</a>
                </li>
                <li class="">
                    
    <a class="" href="../../windows_compute/Root_HNS_network/">Root HNS network</a>
                </li>
                <li class="">
                    
    <a class="" href="../../windows_compute/Utility_tools/">Utility tools</a>
                </li>
                <li class="">
                    
    <a class="" href="../../windows_compute/_Blueprint/"> Blueprint</a>
                </li>
                <li class="">
                    
    <a class="" href="../../windows_compute/vRouter_Linux_implementation/">vRouter Linux implementation</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Tungsten Fabric for Windows Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Ci admin guide &raquo;</li>
        
      
    
    <li>Update Zuul layout</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="update-zuul-layout">Update Zuul layout</h1>
<p>Zuul is a triggering mechanism for Windows CI. It listens for events sent by Gerrit.
Some events make Zuul trigger specific Jenkins jobs. 
Zuul knows which events on which projects should trigger which jobs thanks to a config file.
This config file must be updated when:
<em> one wants to add a project on Gerrit
</em> one wants to change which jobs run on existing projects</p>
<p>For now, update process has 2 steps:
1. Commit updated <code>layout.yaml</code> file to specific Windows CI git repository.
2. Reload Zuul configuration.</p>
<h3 id="1-commit-updated-layoutyaml-file-to-specific-windows-ci-git-repository">1. Commit updated <code>layout.yaml</code> file to specific Windows CI git repository.</h3>
<ol>
<li>Clone <code>github.com/Juniper/contrail-windows-ci</code> repository.</li>
</ol>
<pre><code>git clone https://github.com/Juniper/contrail-windows-ci
</code></pre>

<ol>
<li>Run <code>update-zuul-layout.py</code> script from <code>ansible</code> directory.</li>
</ol>
<pre><code>cd ansible
python .\update-zuul-layout.py
</code></pre>

<ol>
<li>Verify what changed in the <code>ansible/roles/zuul/files/layout.yaml</code> file:</li>
</ol>
<pre><code>git diff
# verify what changed
</code></pre>

<ol>
<li>(Optional) Make any "manual" changes to <code>ansible/roles/zuul/files/layout.yaml</code> file. Do not modify automatically generated lines.</li>
<li>Commit the changes.</li>
<li>Open a PR to <code>development</code> branch of <code>github.com/Juniper/contrail-windows-ci</code>.</li>
<li>Wait for CI checks to pass.</li>
<li>Add one of Windows team members as reviewers.</li>
</ol>
<h3 id="2-reload-zuul-configuration">2. Reload Zuul configuration.</h3>
<ol>
<li>SSH to the <code>winci-mgmt</code> machine using provided credentials.</li>
</ol>
<pre><code>localhost $ ssh SOME_USER@10.84.12.25
</code></pre>

<ol>
<li>Checkout newest version of <code>development</code> branch of <code>github.com/Juniper/contrail-windows-ci</code>.</li>
</ol>
<pre><code>winci-mgmt $ cd ~/ji/juniper-contrail-windows-ci
winci-mgmt $ git checkout development
winci-mgmt $ git pull
</code></pre>

<ol>
<li>Verify that commit with updated <code>layout.yaml</code> is present.</li>
</ol>
<pre><code>winci-mgmt $ git log
</code></pre>

<ol>
<li>Run an ansible playbook that will update and reload Zuul daemon.</li>
</ol>
<pre><code>winci-mgmt $ cd ansible
winci-mgmt $ ansible-playbook -i ~/ji/ansible.hosts play.yml --vault-password-file ~/.ansible-vault
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../contrail_deployment/contrail_ansible_deployer/" class="btn btn-neutral float-right" title="Contrail ansible deployer">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Update_Zuul/" class="btn btn-neutral" title="Update Windows CI Zuulv2"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Update_Zuul/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../contrail_deployment/contrail_ansible_deployer/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
