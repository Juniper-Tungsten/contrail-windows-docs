



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.3, mkdocs-material-3.0.3">
    
    
      
        <title>Devenv in CodiLime VMware lab - Tungsten Fabric for Windows Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../highlight.css">
    
      <link rel="stylesheet" href="../../theme.css">
    
      <link rel="stylesheet" href="../../theme_extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#devenv-in-codilime-vmware-lab" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Tungsten Fabric for Windows Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Tungsten Fabric for Windows Documentation
              </span>
              <span class="md-header-nav__topic">
                Devenv in CodiLime VMware lab
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Tungsten Fabric for Windows Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Tungsten Fabric for Windows Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Ci admin guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Ci admin guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../ci_admin_guide/Dependencies/" title="Dependencies" class="md-nav__link">
      Dependencies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ci_admin_guide/Infrastructure_backups/" title="Infrastructure backups" class="md-nav__link">
      Infrastructure backups
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ci_admin_guide/List_of_VMs_in_Windows_CI/" title="List of all important VMs in Windows CI" class="md-nav__link">
      List of all important VMs in Windows CI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ci_admin_guide/Merge_development_to_production/" title="Merge development to production" class="md-nav__link">
      Merge development to production
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ci_admin_guide/Reconnecting_Host/" title="Reconnecting Host to Contrail Windows CI cluster" class="md-nav__link">
      Reconnecting Host to Contrail Windows CI cluster
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ci_admin_guide/Run_gerrit_pipeline_on_github_PR/" title="Run gerrit pipeline on github PR" class="md-nav__link">
      Run gerrit pipeline on github PR
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ci_admin_guide/Update_Jenkins_slaves/" title="Updating Jenkins slaves" class="md-nav__link">
      Updating Jenkins slaves
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ci_admin_guide/Update_Zuul/" title="Update Windows CI Zuulv2" class="md-nav__link">
      Update Windows CI Zuulv2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ci_admin_guide/Update_private_docker_registry/" title="How to update private docker registry" class="md-nav__link">
      How to update private docker registry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ci_admin_guide/Windows_CI_infrastructure/" title="Windows CI infrastructure diagram" class="md-nav__link">
      Windows CI infrastructure diagram
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ci_admin_guide/Windows_CI_logs_layout/" title="Windows CI logs layout" class="md-nav__link">
      Windows CI logs layout
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Contrail deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Contrail deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CAD_for_windows_design/" title="Contrail-ansible-deployer for Windows design document" class="md-nav__link">
      Contrail-ansible-deployer for Windows design document
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Devenv in CodiLime VMware lab
      </label>
    
    <a href="./" title="Devenv in CodiLime VMware lab" class="md-nav__link md-nav__link--active">
      Devenv in CodiLime VMware lab
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select-private-network-for-devenv" title="Select private network for devenv" class="md-nav__link">
    Select private network for devenv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-machines-addressing" title="Virtual machines addressing" class="md-nav__link">
    Virtual machines addressing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#devenv-setup" title="Devenv setup" class="md-nav__link">
    Devenv setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-testbed-setup" title="Windows Testbed setup" class="md-nav__link">
    Windows Testbed setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller-setup" title="Controller setup" class="md-nav__link">
    Controller setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-ansible-playbook" title="Run Ansible playbook" class="md-nav__link">
    Run Ansible playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-do" title="To do" class="md-nav__link">
    To do
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../contrail_deployment_in_ci/" title="A few words about contrail deployment in Windows CI" class="md-nav__link">
      A few words about contrail deployment in Windows CI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../contrail_deployment_manual/" title="How to deploy Contrail with Windows compute nodes" class="md-nav__link">
      How to deploy Contrail with Windows compute nodes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Developer guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Developer guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer_guide/HNS_error_bestiary/" title="HNS errors bestiary" class="md-nav__link">
      HNS errors bestiary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Building
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Building
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer_guide/building/Dockerized_builder_using_ansible/" title="Dockerized builder using ansible" class="md-nav__link">
      Dockerized builder using ansible
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Style guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Style guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../style_guides/C/" title="C" class="md-nav__link">
      C
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../style_guides/Cpp/" title="Cpp" class="md-nav__link">
      Cpp
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../style_guides/Go/" title="Go" class="md-nav__link">
      Go
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Updating documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Updating documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../updating_documentation/How_to_update_this_documentation/" title="How to update this documentation" class="md-nav__link">
      How to update this documentation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      User guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        User guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user_guide/caveats/" title="Known issues" class="md-nav__link">
      Known issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user_guide/connection_scenarios/" title="Connection scenarios" class="md-nav__link">
      Connection scenarios
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user_guide/requirements/" title="Requirements" class="md-nav__link">
      Requirements
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Windows compute
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Windows compute
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/Communication_Agent_Extension/" title="Communication Agent Extension" class="md-nav__link">
      Communication Agent Extension
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/Container_creation_lifecycle/" title="Container creation lifecycle" class="md-nav__link">
      Container creation lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/Docker_on_Windows/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/Forwarding_extension/" title="Forwarding extension" class="md-nav__link">
      Forwarding extension
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/HyperV_extensible_switch/" title="HyperV extensible switch" class="md-nav__link">
      HyperV extensible switch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/Linux_Overview/" title="Contrail Controller" class="md-nav__link">
      Contrail Controller
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/NBL_processing/" title="NET_BUFFER_LIST processing" class="md-nav__link">
      NET_BUFFER_LIST processing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/Network_creation_lifecycle/" title="Network creation lifecycle" class="md-nav__link">
      Network creation lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/Offloading_IP_checksums_and_other_tasks/" title="Offloading IP Checksums and other tasks" class="md-nav__link">
      Offloading IP Checksums and other tasks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/Root_HNS_network/" title="Root HNS network" class="md-nav__link">
      Root HNS network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/Utility_tools/" title="Utility tools" class="md-nav__link">
      Utility tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/_Blueprint/" title=" Blueprint" class="md-nav__link">
       Blueprint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../windows_compute/vRouter_Linux_implementation/" title="vRouter Linux implementation" class="md-nav__link">
      vRouter Linux implementation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select-private-network-for-devenv" title="Select private network for devenv" class="md-nav__link">
    Select private network for devenv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-machines-addressing" title="Virtual machines addressing" class="md-nav__link">
    Virtual machines addressing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#devenv-setup" title="Devenv setup" class="md-nav__link">
    Devenv setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-testbed-setup" title="Windows Testbed setup" class="md-nav__link">
    Windows Testbed setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller-setup" title="Controller setup" class="md-nav__link">
    Controller setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-ansible-playbook" title="Run Ansible playbook" class="md-nav__link">
    Run Ansible playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-do" title="To do" class="md-nav__link">
    To do
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="devenv-in-codilime-vmware-lab">Devenv in CodiLime VMware lab</h1>
<p>This document describes the steps required to provision a development environment in CodiLime VMware lab.
From high-level perspective steps are as follows:</p>
<ol>
<li>Provision Windows and Linux virtual machines with suitable configuration in CodiLime VMware lab.</li>
<li>Configure Networking on Windows and Linux virtual machines using VMware console.</li>
<li>Run Ansible playbook to deploy Windows Contrail compute and Contrail Controller nodes.</li>
</ol>
<p>Performing steps described below correctly should result in a configured devenv consiting of:</p>
<ul>
<li>2 virtual machines configured as Windows Contrail compute, named <code>[INITIALS]-tb1</code> and <code>[INITIALS]-tb2</code><ul>
<li>Windows will have vRouter dependencies installed</li>
<li>vRouter/vRouter Agent/Docker Driver will not be installed</li>
</ul>
</li>
<li>1 virtual machine configured as Contrail Controller node named <code>[INITIALS]-ctrl</code><ul>
<li>Contrail Controller will be fully installed and configured</li>
</ul>
</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<h3 id="select-private-network-for-devenv">Select private network for devenv</h3>
<p>Because of lacking infrastructure and licensing we simulate private networks based on PVLANs, using VMware's standard virtual switches.
This limits a communication in this private network to a single ESXi host.
Thus each virtual machine from a single devenv must be placed on a single ESXi host.
There are two ESXi hosts at this moment: <code>10.5.88.85</code> and <code>10.5.88.86</code></p>
<p>These private networks are named <code>vS-DevEnvX-Y</code>.
<code>X</code> is an identifier of the host.
<code>Y</code> is an identifier of the network.
<code>X</code> can be:</p>
<ul>
<li>If you chose <code>10.5.88.85</code> as your host, then <code>X = 1</code></li>
<li>If you chose <code>10.5.88.86</code> as your host, then <code>X = 2</code></li>
</ul>
<p>To find an available network for use do the following:</p>
<ul>
<li>In vSphere Web Client, navigate to <code>Networking</code> tab in the navigation pane on the left</li>
<li>On the left should be a list of VMware networks</li>
<li>Look for an available network from networks named <code>vS-DevEnvX-Y</code>:<ul>
<li>Click on the network <code>vS-DevEnvX-Y</code> </li>
<li>Select <code>VMs</code> tab in the center pane</li>
<li>Make sure <code>Virtual Machines</code> option is selected</li>
<li>If the table should be empty, there are no virtual machines in this network, thus it is available</li>
<li>If there are some virtual machines, check another network</li>
</ul>
</li>
</ul>
<h3 id="virtual-machines-addressing">Virtual machines addressing</h3>
<p>This document supports the following addressing scheme for the devenv:</p>
<table>
<thead>
<tr>
<th>Virtual machine</th>
<th>Type</th>
<th>Network Adapter 1</th>
<th>Network Adapter 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>[INITIALS]-tb1</td>
<td>Windows Compute</td>
<td>DHCP, from 10.7.0.0/24 subnet</td>
<td>Static, 172.16.0.1/24</td>
</tr>
<tr>
<td>[INITIALS]-tb2</td>
<td>Windows Compute</td>
<td>DHCP, from 10.7.0.0/24 subnet</td>
<td>Static, 172.16.0.2/24</td>
</tr>
<tr>
<td>[INITIALS]-ctrl</td>
<td>Contrail Controller</td>
<td>DHCP, from 10.7.0.0/24 subnet</td>
<td>Static, 172.16.0.10/24</td>
</tr>
</tbody>
</table>
<p>In this scenario:</p>
<ul>
<li><code>Network Adapter 1</code> corresponds to management adapter (Contrail's mgmt plane)<ul>
<li>On Windows - <code>Ethernet1</code></li>
<li>On CentOS - <code>ens192</code></li>
</ul>
</li>
<li><code>Network Adapter 2</code> corresponds to control adapter (Contrail's control and data plane)<ul>
<li>On Windows - <code>Ethernet2</code></li>
<li>On CentOS - <code>ens224</code></li>
</ul>
</li>
</ul>
<h2 id="devenv-setup">Devenv setup</h2>
<h3 id="windows-testbed-setup">Windows Testbed setup</h3>
<ol>
<li>Create a folder for virtual machines<ul>
<li>Select <code>VMs and Templates</code> tab in navigation pane on the left</li>
<li>Traverse to <code>Dev</code> folder</li>
<li>Right clink on <code>Dev</code> directory and select <code>New folder</code></li>
<li>Provide folder name in the text box<ul>
<li>Name it with your initials, e.g. <code>DS</code></li>
<li>I'll refer to this folder's name as <code>[DESTINATION]</code></li>
</ul>
</li>
</ul>
</li>
<li>Clone virtual machine from <code>Codilime/__Templates/windows/win2016core-bare</code> template<ul>
<li>Select <code>VMs and Templates</code> tab in navigation pane on the left</li>
<li>Traverse to <code>Codilime/__Templates/windows/</code> folder</li>
<li>Right click on <code>win2016core-bare</code> template and select <code>New VM from This Template</code></li>
<li><code>Deploy from Template</code> wizard should appear<ul>
<li>In <code>Select a name and folder</code> step do the following:<ul>
<li>Provide virtual machine name in <code>Enter a name for the virtual machine</code> input box<ul>
<li>Name it using your initials, appending testbed number, e.g. <code>DS-tb1</code></li>
<li>I'll refer to this named as <code>[INITIALS]-tb1</code></li>
</ul>
</li>
<li>Using <code>Select a location for the virtual machine</code> window traverse to <code>Codilime/Dev/[DESTINATION]</code> folder</li>
<li>Select <code>[DESTINATION]</code> folder in the tree</li>
<li>Click <code>Next</code></li>
</ul>
</li>
<li>In <code>Select a compute resource</code> step do the following:<ul>
<li>Expand <code>MSDN</code> item in the resource tree viewer in the middle</li>
<li>Select one of the available hosts from <code>MSDN</code> cluster<ul>
<li><strong>IMPORTANT</strong> Choice is arbitrary, however it is required that all devenv virtual machines are located on the same host</li>
</ul>
</li>
<li>Click <code>Next</code></li>
</ul>
</li>
<li>In <code>Select storage</code> step  do the following:<ul>
<li>Select <code>esxiX-main</code> datastore<ul>
<li><code>X</code> is a host identifier</li>
<li>If you chose <code>10.5.88.85</code> as your host, then <code>X = 1</code></li>
<li>If you chose <code>10.5.88.86</code> as your host, then <code>X = 2</code></li>
</ul>
</li>
<li>Select <code>Thin provision</code> in <code>Select virtual dist format</code> select box</li>
<li>Click <code>Next</code></li>
</ul>
</li>
<li>In <code>Select clone options</code> step do the following:<ul>
<li>Check <code>Customize this virtual machine's hardware (Experimental)</code></li>
<li>Check <code>Power on virtual machine after creation</code></li>
<li>Click <code>Next</code></li>
</ul>
</li>
<li>In <code>Customize hardware</code> step do the following:<ul>
<li>For <code>Network Adapter 1</code> choose <code>v1800_VM</code> from the select menu</li>
<li>For <code>Network Adapter 1</code> check <code>Connect At Power On</code></li>
<li>For <code>Network Adapter 2</code> choose <code>vS-DevEnvX-Y</code> from the select menu<ul>
<li>If no such network is on the list, click <code>Show more networks...</code></li>
<li>Network should be chosen based on steps from <em>Select private network for devenv</em></li>
</ul>
</li>
<li>Click <code>Next</code></li>
</ul>
</li>
<li>In <code>Ready to complete</code> step verify your settings and click <code>Finish</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Configure virtual machine</p>
<ul>
<li>Select <code>VMs and Templates</code> tab in navigation pane on the left</li>
<li>Traverse to <code>Codilime/Dev/[DESTINATION]</code> folder</li>
<li>Left click on <code>[INITIALS]-tb1</code></li>
<li>On virtual machine preview click a gear icon and select <code>Launch Remote Console</code><ul>
<li>If you do not have a VMware Remote Console installed, click <code>Install Remote Console</code> and install a provided MSI</li>
</ul>
</li>
<li>Click <code>Send Ctrl+Alt+Del to virtual machine</code> button</li>
<li>Click on the interior to passthrough mouse and keyboard to the virtual machine</li>
<li>Login using provided credentials</li>
<li>Start PowerShell console</li>
<li>
<p>Change hostname</p>
<pre><code>Rename-Computer "[INITIALS]-tb1"
</code></pre>
</li>
<li>
<p>Disable DHCP on Ethernet1 and preserve address on restart</p>
<pre><code>Set-NetIPInterface -InterfaceAlias Ethernet1 -Dhcp Disabled -PolicyStore PersistentStore
</code></pre>
</li>
<li>
<p>Restart Ethernet1</p>
<pre><code>Restart-NetAdapter -InterfaceAlias Ethernet1
</code></pre>
</li>
<li>
<p>Set static IP address on dataplane adater Ethernet1 (based on addressing scheme from <em>Virtual machines addressing</em>)</p>
<pre><code>New-NetIPAddress -InterfaceAlias Ethernet1 -IPAddress "172.16.0.1" -PrefixLength 24
</code></pre>
</li>
<li>
<p>Verify if IP address is configured correctly</p>
<pre><code>Get-NetIPAddress -InterfaceAlias Ethernet1
</code></pre>
</li>
<li>
<p>Turn off the firewall</p>
<pre><code>Set-NetFirewallProfile -Enabled false
</code></pre>
</li>
<li>
<p>Restart virtual machine</p>
<pre><code>Restart-Computer
</code></pre>
</li>
<li>
<p>Check IP address of <code>Ethernet0</code> adapter</p>
<pre><code>Get-NetIPAddress -InterfaceAlias Ethernet0 -AddressFamily IPv4
</code></pre>
<ul>
<li>Note down shown address; It will be required to connect to this virtual machine using Ansible</li>
</ul>
</li>
<li>
<p>Press <code>Ctrl+Alt</code> to escape VMware Remote Console</p>
</li>
<li>Close VMware Remote Console</li>
</ul>
</li>
</ol>
<p>Now repeat these steps to create a second testbed <code>[INITIALS]-tb2</code></p>
<h2 id="controller-setup">Controller setup</h2>
<ol>
<li>Clone virtual machine from <code>Codilime/__Templates/windows/centos7.4-bare</code> template<ul>
<li>Steps are the same as in <em>Clone virtual machine from <code>Codilime/__Templates/windows/win2016core-bare</code> template</em></li>
<li>This time use <code>[INITIALS]-ctrl</code></li>
</ul>
</li>
<li>
<p>Configure virtual machine</p>
<ul>
<li>Select <code>VMs and Templates</code> tab in navigation pane on the left</li>
<li>Traverse to <code>Codilime/Dev/[DESTINATION]</code> folder</li>
<li>Left click on <code>[INITIALS]-ctrl</code></li>
<li>On virtual machine preview click a gear icon and select <code>Launch Remote Console</code></li>
<li>Click on the interior to passthrough mouse and keyboard to the virtual machine<ul>
<li>If nothing is shown, start typing</li>
</ul>
</li>
<li>Login using provided credentials</li>
<li>
<p>Change hostname</p>
<pre><code># hostnamectl set-hostname "[INITIALS]-ctrl"
</code></pre>
</li>
<li>
<p>Configure static addressing on <code>ens224</code> adapter (<code>Network Adapter 2</code> from addressing scheme)</p>
<ul>
<li>
<p>Edit file <code>/etc/sysconfig/network-scripts/ifcfg-ens224</code> to include following entries</p>
<pre><code>BOOTPROTO=static
DEFROUTE=no
IPADDR=172.16.0.10
NETMASK=255.255.255.0
</code></pre>
</li>
<li>
<p>Restart networking</p>
<pre><code>systemctl restart network
</code></pre>
</li>
<li>
<p>Verify address configuration</p>
<pre><code>ip addr show
</code></pre>
</li>
<li>
<p>Check <code>ens192</code> address</p>
<pre><code>ip addr show ens192
</code></pre>
<ul>
<li>Note down shown address; It will be required to connect to this virtual machine using Ansible</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Reboot virtual machine</p>
<pre><code>systemctl reboot
</code></pre>
</li>
</ul>
</li>
</ol>
<h2 id="run-ansible-playbook">Run Ansible playbook</h2>
<p>This section assumes the reader has Windows Subsystem for Linux (WSL) installed and configured.
If not, please refer to <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">this</a> document for install and configuration details.</p>
<p>All steps below should be done from WSL.</p>
<ol>
<li>
<p>Install required packages</p>
<pre><code>sudo apt install python3 python3-pip python3-virtualenv sshpass
</code></pre>
</li>
<li>
<p>Clone <code>contrail-windows-ci</code> git repository from <a href="https://github.com/Juniper/contrail-windows-ci">https://github.com/Juniper/contrail-windows-ci</a></p>
<pre><code>mkdir ~/dev
cd ~/dev
git clone https://github.com/Juniper/contrail-windows-ci.git
</code></pre>
</li>
<li>
<p>Checkout <code>local-testenv</code> branch</p>
<pre><code>cd ./contrail-windows-ci
git branch local-testenv origin/local-testenv
git checkout local-testenv
</code></pre>
</li>
<li>
<p>Traverse to <code>contrail-windows-ci/ansible</code> directory</p>
<pre><code>cd ./ansible
</code></pre>
</li>
<li>
<p>Create virtualenv for Python</p>
<pre><code>python3 -m virtualenv -p /usr/bin/python3 venv
</code></pre>
</li>
<li>
<p>Active virtualenv</p>
<ul>
<li>shell prompt should change to indicate that virtualenv is activated<pre><code>$ . venv/bin/activate
(venv) $
</code></pre>
</li>
</ul>
</li>
<li>
<p>Install Python dependencies</p>
<pre><code>pip install -r python-requirements.txt
</code></pre>
</li>
<li>
<p>Create a file for a provided Ansible vault key</p>
<pre><code>touch ~/ansible-vault-key
vi ~/ansible-vault-key
# Enter vault key
</code></pre>
</li>
<li>
<p>Copy <code>inventory.testenv</code> file to <code>inventory</code></p>
<pre><code>cp inventory.testenv inventory
</code></pre>
</li>
<li>
<p>Add Windows virtual machines to <code>testbed</code> group by editing the <code>inventory</code> file</p>
<pre><code>[testbed]
[INITIALS]-tb1 ansible_host=MGMT_IP_TB1
[INITIALS]-tb2 ansible_host=MGMT_IP_TB2
</code></pre>
<ul>
<li><code>MGMT_IP_TB1</code>, <code>MGMT_IP_TB2</code> are addresses of <code>Ethernet0</code> adapters we checked earlier</li>
</ul>
</li>
<li>
<p>Add Controller virtual machine to <code>controller</code> group</p>
<pre><code>[controller]
[INITIALS]-ctrl ansible_host=MGMT_IP_CTRL ansible_user=PROVIDED_USER ansible_ssh_pass=PROVIDED_PASSWORD
</code></pre>
<ul>
<li><code>MGMT_IP_CTRL</code> is an address of <code>ens192</code> adapter we checked earlier</li>
<li><code>PROVIDED_USER</code> and <code>PROVIDED_PASSWORD</code> are provided credentials for CentOS</li>
</ul>
</li>
<li>
<p>Test network connection to devenv virtual machines</p>
<pre><code>ping MGMT_IP_TB1
ping MGMT_IP_TB2
ping MGMT_IP_CTRL
</code></pre>
</li>
<li>
<p>Test Ansible connectivity to Windows virtual machines</p>
<pre><code>ansible -i inventory testbed -m win_ping
</code></pre>
</li>
<li>
<p>Test Ansible connectivity to Controller virtual machine</p>
<pre><code>ansible -i inventory controller -m ping
</code></pre>
</li>
<li>
<p>Run <code>configure-local-testenv.yml</code></p>
<pre><code>ansible-playbook -i inventory configure-local-testenv.yml --skip-tags yum-repos
</code></pre>
<ul>
<li>Playbook should take at least an hour to complete</li>
</ul>
</li>
<li>
<p>Verify if Contrail Controller is accessible</p>
<ul>
<li>Access <code>https://MGMT_IP_CTRL:8143</code></li>
</ul>
</li>
</ol>
<h2 id="to-do">To do</h2>
<ul>
<li>Changes in <code>controller</code> role required to provision Linux compute node.</li>
<li>Merge <code>local-testenv</code> to main branch in <code>contrail-windows-ci</code> repository</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../CAD_for_windows_design/" title="Contrail-ansible-deployer for Windows design document" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Contrail-ansible-deployer for Windows design document
              </span>
            </div>
          </a>
        
        
          <a href="../contrail_deployment_in_ci/" title="A few words about contrail deployment in Windows CI" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                A few words about contrail deployment in Windows CI
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.3",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>